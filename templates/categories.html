{% extends 'base.html' %}
{% block title %}Categories{% endblock %}
{% block content %}

<!-- Header -->
<div class="flex flex-col sm:flex-row justify-between sm:items-center mb-10 gap-4">
  <div>
    <h1 class="text-4xl font-bold text-gray-900 tracking-tight">Categories</h1>
    <p class="text-gray-500 text-sm mt-1">Manage and organize your product categories efficiently.</p>
  </div>
  <button id="open-add-modal"
    class="flex items-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold px-5 py-2.5 rounded-xl shadow-md hover:shadow-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-300">
    <span class="text-xl font-bold">+</span> Add Category
  </button>
</div>

<!-- Category Grid -->
<div id="categories-grid"
  class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 transition-all duration-300">
</div>

<!-- Modal -->
<dialog id="category-modal"
  class="rounded-2xl shadow-2xl backdrop:bg-black/50 backdrop:backdrop-blur-sm p-0 border-0 w-full max-w-md transition-all duration-300">
  <form id="category-form" class="bg-white rounded-2xl p-8 space-y-6">
    <h2 class="text-2xl font-semibold text-gray-900 text-center">Category Details</h2>
    <input type="hidden" id="category-id">

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
      <input id="category-name" required
        class="w-full border border-gray-300 rounded-lg px-3 py-2.5 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
    </div>

    <div class="flex justify-end gap-3 pt-4">
      <button type="button" id="cancel-modal"
        class="bg-gray-100 text-gray-700 px-4 py-2.5 rounded-lg font-medium hover:bg-gray-200 transition-colors duration-200">
        Cancel
      </button>
      <button type="submit"
        class="bg-blue-600 text-white px-5 py-2.5 rounded-lg font-semibold hover:bg-blue-700 shadow-sm hover:shadow-md transition-all duration-200">
        Save
      </button>
    </div>
  </form>
</dialog>

<script>
  const modal = document.getElementById('category-modal');
  const form = document.getElementById('category-form');
  const grid = document.getElementById('categories-grid');
  const openAdd = document.getElementById('open-add-modal');
  const cancel = document.getElementById('cancel-modal');

  async function loadCategories() {
    const res = await fetch('/api/categories');
    const cats = await res.json();
    grid.innerHTML = '';
    cats.forEach(c => grid.appendChild(createCard(c)));
  }

  function createCard(c) {
    const div = document.createElement('div');
    div.className = `
      group relative bg-white border border-gray-100 rounded-2xl shadow-sm hover:shadow-md 
      hover:-translate-y-1 transition-all duration-300 p-6 flex flex-col justify-between
    `;
    div.dataset.id = c.id;

    div.innerHTML = `
      <div>
        <h3 class="text-xl font-semibold text-gray-800 mb-3">${c.name}</h3>
      </div>
      <div class="flex gap-3 mt-4">
        <button data-id="${c.id}" 
          class="edit-btn flex-1 bg-amber-500 text-white px-4 py-1.5 rounded-lg font-medium 
          hover:bg-amber-600 transition-colors duration-200">
          Edit
        </button>
        <button data-id="${c.id}" 
          class="delete-btn flex-1 bg-red-600 text-white px-4 py-1.5 rounded-lg font-medium 
          hover:bg-red-700 transition-colors duration-200">
          Delete
        </button>
      </div>
      <div class="absolute inset-0 opacity-0 group-hover:opacity-100 bg-gradient-to-br from-blue-50 via-transparent to-transparent rounded-2xl transition-opacity duration-300 pointer-events-none"></div>
    `;
    return div;
  }

  openAdd.onclick = () => {
    form.reset();
    document.getElementById('category-id').value = '';
    modal.showModal();
  };
  cancel.onclick = () => modal.close();

  form.onsubmit = async e => {
    e.preventDefault();
    const id = document.getElementById('category-id').value;
    const data = { name: document.getElementById('category-name').value };
    const method = id ? 'PUT' : 'POST';
    const url = id ? `/api/categories/${id}` : '/api/categories';
    const res = await fetch(url, {
      method,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    if (res.ok) {
      const cat = await res.json();
      if (id) {
        const card = grid.querySelector(`[data-id="${id}"]`);
        card.querySelector('h3').textContent = cat.name;
      } else {
        grid.appendChild(createCard(cat));
      }
      modal.close();
    }
  };

  grid.addEventListener('click', async e => {
    const btn = e.target;
    const id = btn.dataset.id;
    const card = btn.closest('[data-id]');
    if (btn.classList.contains('edit-btn')) {
      const res = await fetch(`/api/categories/${id}`);
      const cat = await res.json();
      document.getElementById('category-id').value = cat.id;
      document.getElementById('category-name').value = cat.name;
      modal.showModal();
    } else if (btn.classList.contains('delete-btn')) {
      if (confirm('Delete this category?')) {
        await fetch(`/api/categories/${id}`, { method: 'DELETE' });
        card.remove();
      }
    }
  });

  loadCategories();
</script>
{% endblock %}
